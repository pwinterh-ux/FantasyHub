{% extends "base.html" %}

{% block content %}
<style>
  /* Minimal layout helpers; reuses your tile/btn styles. */
  .pricing-head { display:flex; align-items:center; justify-content:space-between; gap:12px; margin: 6px 0 14px; }
  .pricing-title { margin:0; font-size:22px; letter-spacing:.2px; }
  .billing-toggle { display:flex; gap:8px; align-items:center; background: rgba(15, 23, 42, .75); padding:6px; border-radius:999px; border:1px solid var(--border); }
  .billing-toggle button { border:0; background:transparent; color:var(--muted); padding:6px 12px; border-radius:999px; cursor:pointer; }
  .billing-toggle button.active { background: rgba(11,18,32,.85); color:#fff; border:1px solid rgba(255,255,255,.12); }
  .plans-grid { display:grid; grid-template-columns: repeat(1, minmax(0, 1fr)); gap:12px; }
  @media (min-width: 820px) { .plans-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
  .plan { display:flex; flex-direction:column; gap:8px; }
  .plan h3 { margin:0; font-size:18px; }
  .subtle { color: var(--muted); font-size: 13px; }
  .features { list-style:none; margin:8px 0 2px; padding:0; color: var(--muted); }
  .features li { margin:6px 0; }
  .badge { display:inline-block; padding:3px 8px; border-radius:999px; font-size:12px; background:#0f172a; border:1px solid rgba(255,255,255,.14); }
  .price { font-size:24px; font-weight:700; margin-top:4px; }
  .note { margin-top:8px; font-size:12px; color:var(--muted); }
</style>

<div class="pricing-head">
  <h2 class="pricing-title">Pricing</h2>
  <div class="billing-toggle" role="tablist" aria-label="Billing cadence">
    <button id="toggle-weekly" class="active" data-mode="weekly" aria-selected="true">Weekly</button>
    <button id="toggle-season" data-mode="season">Season</button>
  </div>
</div>

<div class="plans-grid" id="plans">
  <!-- Free -->
  <div class="tile pad plan">
    <h3>Free</h3>
    <div class="subtle">Try multi-league tools</div>
    <div class="price">$0</div>
    <ul class="features">
      <li>Up to <b>3 leagues</b></li>
      <li>Live scoring + trade inbox</li>
      <li><b>1</b> mass offer / week (to <b>6</b> recipients)</li>
      <li>Rapid Fire lineup (<span class="subtle">1 lineup / week</span>)</li>
    </ul>
    <div><button class="btn" disabled>Current</button></div>
  </div>

  <!-- Manager 5 -->
  <div class="tile pad plan">
    <h3>Manager 5</h3>
    <span class="badge">Starter</span>
    <div class="subtle" data-weekly-label>$5 / week</div>
    <div class="price" data-weekly-price>$5</div>
    <div class="subtle" data-season-label style="display:none;">$30 / season</div>
    <div class="subtle" data-season-price style="display:none;">$30 total</div>
    <ul class="features">
      <li>Up to <b>5 leagues</b></li>
      <li>All Free features</li>
      <li><b>3</b> mass offers / day</li>
      <li>Aggregate Showdown + presets</li>
    </ul>
    <div>
      <button
        class="btn checkout"
        data-weekly-price-id="{{ (prices.MGR5_WEEKLY if prices is defined else '') or '' }}"
        data-season-price-id="{{ (prices.MGR5_SEASON if prices is defined else '') or '' }}"
      >Get Manager 5</button>
    </div>
  </div>

  <!-- Manager 12 -->
  <div class="tile pad plan">
    <h3>Manager 12</h3>
    <span class="badge">Most Popular</span>
    <div class="subtle" data-weekly-label>$8 / week</div>
    <div class="price" data-weekly-price>$8</div>
    <div class="subtle" data-season-label style="display:none;">$55 / season</div>
    <div class="subtle" data-season-price style="display:none;">$55 total</div>
    <ul class="features">
      <li>Up to <b>12 leagues</b></li>
      <li>All Manager 5 features</li>
      <li><b>Unlimited</b> mass offers / day</li>
    </ul>
    <div>
      <button
        class="btn checkout"
        data-weekly-price-id="{{ (prices.MGR12_WEEKLY if prices is defined else '') or '' }}"
        data-season-price-id="{{ (prices.MGR12_SEASON if prices is defined else '') or '' }}"
      >Get Manager 12</button>
    </div>
  </div>

  <!-- Unlimited -->
  <div class="tile pad plan">
    <h3>Unlimited</h3>
    <span class="badge">Power User</span>
    <div class="subtle" data-weekly-label>$12 / week</div>
    <div class="price" data-weekly-price>$12</div>
    <div class="subtle" data-season-label style="display:none;">$85 / season</div>
    <div class="subtle" data-season-price style="display:none;">$85 total</div>
    <ul class="features">
      <li><b>Unlimited leagues</b></li>
      <li>All Manager 12 features</li>
      <li>Priority feedback channel</li>
    </ul>
    <div>
      <button
        class="btn checkout"
        data-weekly-price-id="{{ (prices.UNLIMITED_WEEKLY if prices is defined else '') or '' }}"
        data-season-price-id="{{ (prices.UNLIMITED_SEASON if prices is defined else '') or '' }}"
      >Get Unlimited</button>
    </div>
  </div>

  <!-- Founder Pass -->
  <div class="tile pad plan">
    <h3>Founder Pass</h3>
    <span class="badge">Limited</span>
    <div class="subtle">$150 one-time</div>
    <div class="price">$150</div>
    <ul class="features">
      <li><b>2 seasons</b> Unlimited</li>
      <li>Vote on next features</li>
      <li>Private Discord</li>
    </ul>
    <div>
      <button
        class="btn checkout"
        data-onetime-price-id="{{ (prices.FOUNDER_ONETIME if prices is defined else '') or '' }}"
        data-mode="payment"
      >Get Founder Pass</button>
    </div>
  </div>
</div>

<p class="subtle" style="margin-top:12px;">
  Weekly passes shine during the first 10â€“12 NFL weeks. Seasonal plans include offseason coverage through MFL rollover.
</p>

<script>
  (function () {
    const weeklyBtn = document.getElementById('toggle-weekly');
    const seasonBtn = document.getElementById('toggle-season');
    const plans = document.getElementById('plans');

    function setMode(mode) {
      const weekly = mode === 'weekly';
      weeklyBtn.classList.toggle('active', weekly);
      seasonBtn.classList.toggle('active', !weekly);
      plans.querySelectorAll('[data-weekly-label]').forEach(el => el.style.display = weekly ? '' : 'none');
      plans.querySelectorAll('[data-weekly-price]').forEach(el => el.style.display = weekly ? '' : 'none');
      plans.querySelectorAll('[data-season-label]').forEach(el => el.style.display = weekly ? 'none' : '');
      plans.querySelectorAll('[data-season-price]').forEach(el => el.style.display = weekly ? 'none' : '');
      document.body.dataset.billingMode = mode;
    }

    weeklyBtn.addEventListener('click', () => setMode('weekly'));
    seasonBtn.addEventListener('click', () => setMode('season'));
    setMode('weekly');

    async function postCheckout(priceId, modeOverride) {
      if (!priceId) { alert("This plan isn't available yet."); return; }
      const modeParam = modeOverride ? ('?mode=' + encodeURIComponent(modeOverride)) : '';
      const resp = await fetch('/billing/checkout/' + encodeURIComponent(priceId) + modeParam, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      });
      const data = await resp.json().catch(() => ({}));
      if (!resp.ok || !data.url) {
        alert((data && data.error) || 'Unable to start checkout. Please try again.');
        return;
      }
      window.location = data.url;
    }

    document.querySelectorAll('.checkout').forEach(btn => {
      btn.addEventListener('click', () => {
        const mode = document.body.dataset.billingMode || 'weekly';
        const onetime = btn.getAttribute('data-onetime-price-id');
        if (onetime) return postCheckout(onetime, 'payment');
        const weeklyId = btn.getAttribute('data-weekly-price-id');
        const seasonId = btn.getAttribute('data-season-price-id');
        const chosen = (mode === 'weekly') ? weeklyId : seasonId;
        postCheckout(chosen, 'subscription');
      });
    });
  })();
</script>
{% endblock %}
